<link href="/static/css/status.css" rel="stylesheet">

{% extends 'blueprint.html' %}
{% block main %}
<style>
.chat-container {
    width: 400px;
    background-color: #fff;
    padding: 20px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    margin: 10px;
}

h1 {
    text-align: center;
    color: #333;
}

.home-container {
    display: flex;
    justify-content: center;
    height: 100%;
}

.chat-box {
    height: 600px;
    overflow-y: auto;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-bottom: 15px;
    background-color: #fafafa;
}

.chat-message {
    margin-bottom: 10px;
    padding: 8px;
    border-radius: 5px;
    max-width: 80%;
    word-wrap: break-word;
}

.user-message {
    background-color: #44a3c37e;
    text-align: right;
    margin-left: auto;
}

.bot-message {
    background-color: #44a3c3c0;
    text-align: left;
}

.input-area {
    display: flex;
    justify-content: space-between;
    gap: 20px;
}

.background {
    background-color: #F0F0F0;
    border-radius: 45px 45px 0px 0px;
    height: 90%;
}

input[type="text"] {
    width: 80%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
}

button {
    padding: 10px 15px;
    background-color: #36acd0;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

button:hover {
    background-color: #2696b8;
}

</style>


<div class="background">
    <div class="home-container">
        <div class="chat-container">
            <h1>Chatbot de Usinagem</h1>
            <div id="chat-box" class="chat-box">
                <!-- Respostas do bot aparecerão aqui -->
            </div>
            <div class="input-area">
                <input type="text" id="user-input" placeholder="Digite sua pergunta...">
                <button onclick="sendMessage()">Enviar</button>
            </div>
        </div>        
    </div>
</div>
<footer class="small text-center terms-of-usage">
    <hr class="footer-hr">
    © 2024 Piveta Ferramentas. Todos os direitos reservados. <a href="/politica-de-privacidade">Política de
        privacidade</a>
</footer>

<script>
    async function sendMessage() {
        const userInput = document.getElementById('user-input').value;
        if (!userInput) return;

        // Exibir a mensagem do usuário no chat
        const chatBox = document.getElementById('chat-box');
        chatBox.innerHTML += `<div class="chat-message user-message">${userInput}</div>`;

        // Limpar campo de entrada
        document.getElementById('user-input').value = '';

        // Enviar a pergunta para o servidor Flask
        const response = await fetch('/chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ text: userInput }),
        });

        const data = await response.json();
        let botResponse = data.response;

        // Formatando a resposta (quebras de linha, listas, etc.)
        botResponse = botResponse
            .replace(/\n/g, '<br>')  // Substitui quebras de linha por <br>
            .replace(/(\*\*)(.*?)\1/g, '<strong>$2</strong>')  // Negrito com **
            .replace(/(\*)(.*?)\1/g, '<em>$2</em>')  // Itálico com *
            .replace(/`([^`]+)`/g, '<code>$1</code>');  // Código com `

        // Exibir a resposta do bot no chat
        chatBox.innerHTML += `<div class="chat-message bot-message">${botResponse}</div>`;
        
        // Rolagem automática para o final da conversa
        chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>

{% endblock %}